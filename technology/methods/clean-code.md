## 代码整洁之道

### 第1章 整洁代码
1. 什么是整洁代码
* 只做好一件事
* 简单直接
* 意图明确
* 单元测试
* 尽量少的依赖关系

2. 破窗理论和童子军军规  
* 烂代码不去管它只会越来越烂
* 当你离开一个地方时，要让它比你来之前更干净

3. 代码要易读

### 第2章 有意义的命名
1. 避免误导
  * 不使用区别较小的名称
  * 不使用小写l、大写O作变量名
2. 做有意义的区分
  * 不以数字系列命名（a1, a2, a3）
  * 不使用无区别的命名（product/productInfo/productData）
  * 不用冗余的命名（表明带table）
3. 使用可搜索的名称
  * 单字母名称和数字常量很难在上下文中找出
4. 避免使用编码
5. 添加有意义的语境

### 第3章 函数
1. 函数应该短小  
* if/else/while语句的代码块应该只有一行，该行应该是一个函数调用语句
* 函数的缩进层级不应该多于两层

2. 函数应该只做一件事  
要判断函数是否不止做了一件事，可以看是否能再拆出一个函数，该函数不仅只是单纯地重新诠释其实现。

3. 使用描述性的函数名称

4. 函数参数  
最理想的函数参数数量是0个，其次是1个，再次是2个，尽量避免3个以上的参数。  
如果函数需要三个以上的参数，说明其中的一些参数应该封装成类。

5. 无副作用

6. 使用异常替代错误码

7. 处理错误的函数不该做其他事情

### 第4章 注释
程序员应当负责将注释保持在可维护、有关联、精确的高度，但更应该把力气用在写清楚代码上，直接保证无需编写注释。

* 不准确的注释要比没注释坏的多。
* 真实的地方只有一处：代码。只有代码能忠实告诉你它做的事。
* 注释不能美化糟糕的代码。
* 用代码来阐述信息。

好注释  
  * 法律信息
  * 提供信息的注释
  * 对意图的解释
  * 警示
  * TODO

坏注释  
* 喃喃自语
* 多余的注释。完全没有文档上的价值，并不能比代码本身提供更多的信息。
* 误导性注释
* 日志式注释
* 不明显的联系
* 注释信息过多

### 第5章 格式
代码风格和可读性会影响代码可维护性和扩展性。

1. 垂直格式
* 大多数200行以内，最多500行。
* 文件名称应该告诉我们是否在正确的模块中。
* 源文件顶部应该给出高层次的概念和算法。细节往下逐渐展开，直至找到源文件中最底层的函数和细节。
* 如果说空白行隔开了概念，靠近的代码行则暗示了他们之间的紧密关系。所以，紧密相关的代码应该靠近。
* 相关函数。若某个函数调用了另外一个，就应该把它们放到一起，而且调用者应该尽可能放在被调用者上面。

### 第6章 对象和数据结构
过程式代码便于在不改动原有数据结构的前提下添加新函数，面向对象代码便于在不该动既有函数的前提下添加新类。  
模块不应了解它所操作的对象的内部情形，对象隐藏数据，暴露操作。

### 第7章 错误处理
* 遇到错误时，最好是抛出异常而不是返回错误码。如果是返回错误码，调用方需要写很多异常处理逻辑。  
* 先写try-catch-finally语句。  
* 抛出异常时，提供足够的环境说明，以便判断错误的来源。如果应用中有日志系统，传递足够的信息给catch块，并记录下来。  
* 常规流程不要写在异常处理中。  
* 不要返回null值，否则调用方需要不停的判空。

### 第8章 边界
在使用第三方代码时，我们必须加倍小心，确保未来的修改不至于代价太大。  
避免我们的代码中过多的了解第三方代码中的特定信息。

### 第9章 单元测试

**TDD三定律**  
1. 在编写不能通过的单元测试之前，不可编写生产代码
2. 只可编写刚好无法通过的单元测试，不能编译也不算通过
3. 只编写刚好足以通过当前失败测试的生产代码

**保持测试整洁**

单元测试让代码可扩展、可维护、可复用

### 第10章 类
类应该短小，类的名称应该描述其权责。

**单一权责原则**

系统应该由许多短小的类而不是少量巨大的类组成。每个小类封装一个权责，只有一个修改的原因，并与少数其他类一起协同达成期望的系统行为。  

每个达到一定规模的系统都会包括大量的逻辑和复杂性。管理这种复杂性的首要目标就是加以组织，以便开发者知道在哪能找到东西，并且在某个特定时间只需要理解直接有关的复杂性。

**内聚**

### 第11章 系统
软件系统应将启动过程和启动过程之后的运行时逻辑分离开，在启动过程中构建应用对象。

将构造和使用分开的方法之一是将全部构造过程搬迁至main或者被称之为卖弄的模块中，设计系统的其余部分，假设所有对象都已正确构造和设置。  
main函数创建系统所需的对象，再传递给应用程序，应用程序只管使用。

**AOP，面向方面编程**  

将关注面恰当切分。

### 第12章 迭进
简单设计四条规则  

* 运行所有测试
* 不可重复
* 表达程序员的意图
* 尽可能减少类和方法的数量

运行所有测试：  
全面测试并持续通过所有测试的系统。不可测试的系统同样不可验证。不可验证的系统不应部署。  
只要系统可测试，就会导向保持类短小且目的单一的设计方案。

重构：  
提升内聚性，降低耦合度，切分关注面，模块化系统性关注面，缩小函数和类的尺寸，选用更好的名称，编写良好的单元测试，函数和类的数量要少。

表达力：  

